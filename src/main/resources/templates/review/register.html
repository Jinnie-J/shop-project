<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<th:block th:replace="~{/layout/basic :: setContent(~{this::content} )}">

    <th:block th:fragment="content">
        <h1 class="mt-4">후기 등록</h1>

        <form th:action="@{/question/register}" th:method="post">
            <div class="form-group">
                <label>Product</label>
                <input type="text" class="form-control" name="pno" placeholder="pno 출력">
            </div>
            <div class="form-group">
                <label>Title</label>
                <input type="text" class="form-control" name="title" paceholder="Enter Title">
            </div>
            <div class="form-group">
                <label>Content</label>
                <textarea class="form-control" rows="5" name="content"></textarea>
            </div>

            <div class="form-group">
                <label>Writer Email</label>
                <input type="email" class="form-control" name="writerEmail" placeholder="Enter Writer Email">
            </div>

            <div class="form-group fileForm">
                <label> 후기 사진</label>
                <div class="custom-file">
                    <input type="file" class="custom-file-input files" id="fileInput" multiple>
                    <label class="custom-file-label" data-browse="Browse"></label>
                </div>
            </div>
            <div class="box">

            </div>

            <button type="submit" class="btn btn-primary">submit</button>
        </form>

        <script th:src="@{/vendor/jquery/jquery.min.js}"></script>
        <script>
            $(document).ready(function(e){

                var regex = new RegExp("(.*?)\.(exe|sh|zip|alz|tiff)$");
                var maxSize= 10485760;

                function checkExtension(fileName, fileSize){
                    if(fileSize>= maxSize){
                        alert("파일 사이즈 초과");
                        return false;
                    }
                    if(regex.test(fileName)){
                        alert("해당 종류의 파일은 업로드할 수 없습니다.");
                        return false;
                    }
                    return true;
                }
                $(".custom-file-input").on("change",function(){
                    var fileName = $(this).val().split("\\").pop();
                    $(this).siblings(".custom-file-label").addClass("selected").html(fileName);

                    var formData = new FormData();
                    var inputFile = $(this);
                    var files= inputFile[0].files;
                    var appended=false;

                    for(var i=0;i<files.length;i++){
                        if(!checkExtension(files[i].name, files[i].size)){
                            return false;
                        }
                        console.log(files[i]);
                        formData.append("uploadFiles",files[i]);
                        appended=true;
                    }
                    if(!appended){return;}

                    for(var value of formData.values()){
                        console.log(value);
                    }
                    $.ajax({
                        url: '/uploadAjax',
                        processData: false,
                        contentType: false,
                        data:formData,
                        type:'POST',
                        dataType:'json',
                        success: function(result){
                            console.log(result);
                            showResult(result);
                        },
                        error:function(jqXHR, textStatus, errorThrown){
                            console.log(textStatus);
                        }
                    });
                }); //end change event

            });
        </script>
    </th:block>
</th:block>